(()=>{var pc=(()=>{if(document.getElementById('root'))return!0;return!1})();var documentElement=(()=>{if(navigator.userAgent.toLowerCase().match(/webkit|msie 5/)){if(navigator.userAgent.indexOf('Chrome')!=-1){return document.documentElement}
else{return document.body}}
else{return document.documentElement}})();var pbvStyle=(()=>{if(pc){return'  #pbvContainer .flex {display: flex;}#pbvContainer .none {display: none;}#pbvContainer .aBut {display: block;margin: auto 0 auto 5px;padding: 3px 6px;border-radius: 16px;background-color: #eee;color: #666;cursor: pointer;text-align: center;text-decoration: none;}#pbvContainer a {cursor: pointer;}#pbvNav .navContents {margin-top: -1px;padding: 13px 16px 16px;font-weight: 700;font-size: 16px;color: #999;text-decoration: none;border-top: 4px solid transparent;-webkit-transition: color .2s;transition: color .2s;}#pbvNav .navContents:hover {color: #333;}#pbvNav .navContents.active {border-top: 4px solid #0096fa;color: #333;}#pbvMenu {margin: 30px 0;padding: 0;}#pbvContainer .mode label {display: block;margin: auto 5px auto 0;cursor: pointer;}#pbvContainer .mode input[type=radio] {cursor: pointer;}#pbvContainer .mode input[type=text] {-webkit-box-flex: 0;-webkit-flex: none;flex: none;padding: 3px 5px;width: 163px;height: 20px;border: 1px solid #becad7;font-size: 14px;line-height: 1;color: #555;border-radius: 0;outline: 0;-webkit-appearance: none;background-color: #fff;}#searchBut {-webkit-box-flex: 0;-webkit-flex: none;flex: none;width: 50px;height: 28px;background-color: #becad7;background-image: url("https://s.pximg.net/www/js/spa/00545159b33bfc46a2dc0eff7ef34f5b.png");background-position: 50%;background-repeat: no-repeat;background-size: 16px 16px;border: none;cursor: pointer;}#searchBut:hover {background-color: #ced7e1;}#itemList {margin: 0 -12px -24px;padding: 0;display: flex;flex-wrap: wrap;align-content: flex-start;list-style: none;}#itemList li {margin: 0 12px 24px;}#itemList li>div {width: 184px;margin: 0px;}#itemList li>div>div:nth-child(1) {position: relative;margin-bottom: 4px;}#itemList li>div>div:nth-child(1)>div {position: relative;width: 184px;height: 184px;}#itemList li>div>div:nth-child(1)>div>a {text-decoration: none;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1) {position: absolute;top: 0px;left: 0px;right: 0px;box-sizing: border-box;display: flex;z-index: 1;padding: 4px 4px 0px;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(1) {display: flex;flex-flow: row wrap;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(1)>div {margin: 2px;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(1)>div>div {color: rgb(255, 255, 255);font-weight: bold;font-size: 10px;line-height: 1;padding: 3px 6px;border-radius: 3px;background: rgb(255, 64, 96);}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(2) {display: flex;-webkit-box-align: center;align-items: center;box-sizing: border-box;margin-left: auto;height: 20px;color: rgb(255, 255, 255);font-size: 10px;line-height: 12px;font-weight: bold;flex: 0 0 auto;padding: 4px 6px;background: rgba(0, 0, 0, 0.32);border-radius: 10px;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(2)>svg {stroke: none;line-height: 0;font-size: 0px;width: 9px;height: 10px;fill: currentcolor;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(2)>span {margin-left: 2px;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2) {display: flex;-webkit-box-align: center;align-items: center;-webkit-box-pack: center;justify-content: center;width: 100%;height: 100%;background-size: cover;background-color: rgb(255, 255, 255);border-radius: 4px;background-position: center center;background-repeat: no-repeat;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2)::before {content: "";position: absolute;display: block;top: 0px;left: 0px;width: 100%;height: 100%;background-color: rgba(0, 0, 0, 0.02);}#itemList li>div>div:nth-child(1)>div>a:hover>div:nth-child(2) {opacity: 0.8;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2)>svg {width: 48px;height: 48px;stroke: none;fill: rgb(255, 255, 255);line-height: 0;font-size: 0px;vertical-align: middle;}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2)>svg circle {fill: rgb(0, 0, 0);fill-opacity: 0.4;}#itemList li>div>a:nth-child(2) {display: inline-block;max-width: 100%;text-overflow: ellipsis;white-space: nowrap;line-height: 22px;font-size: 14px;font-weight: bold;color: rgb(31, 31, 31);overflow: hidden;text-decoration: none;transition: color 0.2s ease 0s;}#itemList li>div>a:nth-child(2):visited {color: rgb(173, 173, 173);}#itemList li>div>a:nth-child(2):hover {color: rgb(92, 92, 92);}#itemList li>div>div:nth-child(3) {display: flex;-webkit-box-align: center;align-items: center;width: 100%;}#itemList li>div>div:nth-child(3)>div {margin-right: 4px;}#itemList li>div>div:nth-child(3)>div>a {position: relative;display: block;width: 16px;height: 16px;border-radius: 50%;background-size: cover;background-position: top;-webkit-box-flex: 0;-webkit-flex: none;flex: none;}#itemList li>div>div:nth-child(3)>div>a:before {position: absolute;display: block;content: "";top: 0;left: 0;width: 100%;height: 100%;background-color: rgba(0,0,0,.02);}#itemList li>div>div:nth-child(3)>a {display: inline-block;line-height: 16px;font-size: 12px;color: rgb(173, 173, 173);text-overflow: ellipsis;white-space: nowrap;text-decoration: none;overflow: hidden;}#iframeBookmark {margin: 16px 0;}#bookmarkReadStrat {padding: 8px 14px;z-index: 5;}#pbvContainer .overlayContainer {position: relative;padding: 10px 0;}#pbvContainer .overlay {position: absolute;left: -1%;width: 102%;height: 100%;z-index: 2;background: rgba(0,0,0,.2);}#dataOption .textareaContainer {width: 100%;height: 320px;}#optionTextarea {width: 100%;height: 100%;}#dataOption .butContainer {margin: 20px 0;padding: 0 0 10px 0;}#dataOption .aBut {margin: auto 5px auto 0;}'}
return'<style media="screen">#pbvContainer .flex {display: flex;}#pbvContainer .none {display: none;}#pbvContainer .aBut {display: block;margin: auto 0 auto 5px;padding: 3px 6px;border-radius: 16px;background-color: #eee;color: #666;cursor: pointer;text-align: center;text-decoration: none;}#pbvMenu {margin: 30px 0;padding: 0;}#pbvContainer .mode label {display: block;margin: auto 5px auto 0;cursor: pointer;}#pbvContainer .mode input {cursor: pointer;}#searchBut {-webkit-box-flex: 0;-webkit-flex: none;flex: none;width: 50px;height: 32px;margin: auto;background-color: #becad7;background-image: url("https://s.pximg.net/www/js/spa/00545159b33bfc46a2dc0eff7ef34f5b.png");background-position: 50%;background-repeat: no-repeat;background-size: 16px 16px;border: none;cursor: pointer;}#itemList>div {width: 50%;display: inline-block;position: relative;}#itemList>div>div {display: inline-block;box-sizing: border-box;position: relative;width: 100%;vertical-align: bottom;}#itemList>div>div>a>div {width: 100%;height: 100%;position: relative;background: #fff;overflow: hidden;}#itemList>div>div>a>div>div.square {display: block;height: 0;width: 100%;padding-bottom: 100%;opacity: 0;}#itemList>div>div>a>div>div.image {position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-size: cover;}#itemList>div>div>a>div>div.image>div.count {position: absolute;top: 4px;right: 4px;display: inline-block;margin: 0;padding: 0 6px;line-height: 19px;color: #fff;background: rgba(0,0,0,.4);border-radius: 20px;font-size: 10px;font-weight: 700;}#itemList>div>div>a>div>div.image>div.count>img {vertical-align: middle;height: 9px;margin-right: 3px;}#itemList>div>div>a>div>div.image>div.r18 {position: absolute;top: 2px;left: 4px;display: inline-block;}#itemList>div>div>a>div>div.image>div.r18>span {display: inline-block;font-size: 10px;line-height: 10px;font-weight: 700;padding: 3px 6px;border-radius: 3px;color: rgb(255, 255, 255);background: rgb(255, 64, 96);}#itemList>div>div>a>div>div.image>div.ugoku {position: absolute;top: 50%;left: 50%;width: 32%;height: 32%;background: rgba(0,0,0,.4);border-radius: 100%;-webkit-transform: translateX(-50%) translateY(-50%);transform: translateX(-50%) translateY(-50%);}#itemList>div>div>a>div>div.image>div.ugoku>img {position: absolute;top: 50%;left: 50%;height: 45%;-webkit-transform: translateX(-37.5%) translateY(-50%);transform: translateX(-37.5%) translateY(-50%);}#bookmarkAdd .aBut {margin: 5px;flex-grow: 1;}#bookmarkAdd label {margin: auto;}#bookmarkAdd .iframeContainer {width: 100%;height: 320px;margin: 16px 0;overflow: scroll;}#pbvContainer .overlayContainer {position: relative;padding: 10px 0;}#pbvContainer .overlay {position: absolute;left: -1%;width: 102%;height: 100%;z-index: 2;background: rgba(0,0,0,.2);}#bookmarkReadStrat {padding: 8px 14px;z-index: 5;}#dataOption .textareaContainer {width: 100%;height: 320px;}#optionTextarea {width: 100%;height: 100%;}#dataOption .butContainer {margin: 20px 0;padding: 0 0 10px 0;}#dataOption .aBut {margin: 8px;}</style>'})();var pbvNav=(()=>{return'<a href="javascript:void(0);" id="navBookmark" class="navContents active">ブックマーク</a><a href="javascript:void(0);" id="navOption" class="navContents">オプション</a>'})();var pbvBookmarkHTML=(()=>{if(pc){return'<menu id="pbvMenu" class="flex"><div class="mode flex"><label><span>登録順</span><input type="radio" id="radioNormal" name="radioMode" checked></label><label><span>ランダム</span><input type="radio" id="radioRandom" name="radioMode"></label></div><input type="search" id="inputSearch" value="" placeholder="検索" style="flex-grow:1;"><div class="buttons flex"><a href="javascript:void(0);" id="searchBut"></a></div></menu><ul id="itemList"></ul>'}
return'<menu id="pbvMenu"><div class="flex" style="display:flex;"><input type="search" id="inputSearch" value="" placeholder="検索" style="flex-grow:1;"><a href="javascript:void(0);" id="searchBut"></a></div><div class="mode flex"><label><span>登録順</span><input type="radio" id="radioNormal" name="radioMode" checked></label><label><span>ランダム</span><input type="radio" id="radioRandom" name="radioMode"></label></div></menu><span id="itemList"></span>'})();var pbvOptionHTML=(()=>{if(pc){return'<div id="bookmarkAdd" class="overlayContainer"><div class="overlay none"></div><h2>ブックマークの読み込み</h2><div><div class="flex"><label><span>ページ数</span><input type="number" id="inputPageCount" value="1" min="1" max="9999"></label><a href="javascript:void(0);" id="jumpPageCount" class="aBut">移動</a><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="jumpOldPage" class="aBut">旧ブックマークページ</a><a href="javascript:void(0);" id="jumpNewPage" class="aBut">新ブックマークページ</a></div><iframe id="iframeBookmark" src="" width="100%" height="320px"></iframe></div><div class="mode flex"><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="bookmarkReadStrat" class="aBut" style="padding: 8px 14px;">開始</a></div></div><div id="dataOption"><h2>データの管理</h2><div class="textareaContainer"><textarea id="optionTextarea"></textarea></div><div class="butContainer flex"><a href="javascript:void(0);" id="butDataShow" class="aBut">データの表示</a><a href="javascript:void(0);" id="butDataOverwrite" class="aBut">データの上書き</a><a href="javascript:void(0);" id="butDownloadData" class="aBut">データのダウンロード</a><a href="javascript:void(0);" id="butLoadWithAjax" class="aBut">データの読み込み</a></div></div>'}
return'<div id="bookmarkAdd" class="overlayContainer"><div class="overlay none"></div><h2>ブックマークの読み込み</h2><div class="flex"><a href="javascript:void(0);" id="jumpOldPage" class="aBut">旧ブックマークページ</a><a href="javascript:void(0);" id="jumpNewPage" class="aBut">新ブックマークページ</a></div><div class="flex"><label><span>ページ数</span><input type="number" id="inputPageCount" value="1" min="1" max="9999"></label><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="jumpPageCount" class="aBut">移動</a></div><div class="iframeContainer"><iframe id="iframeBookmark" src="" width="100%" height="320px"></iframe></div><div class="mode flex"><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="bookmarkReadStrat" class="aBut" style="padding: 8px 14px;">開始</a><div style="flex-grow: 1;"></div></div></div><div id="dataOption"><h2>データの管理</h2><div class="textareaContainer"><textarea id="optionTextarea"></textarea></div><div class="butContainer"><a href="javascript:void(0);" id="butDataShow" class="aBut">データの表示</a><a href="javascript:void(0);" id="butDataOverwrite" class="aBut">データの上書き</a><a href="javascript:void(0);" id="butDownloadData" class="aBut">データのダウンロード</a><a href="javascript:void(0);" id="butLoadWithAjax" class="aBut">データの読み込み</a></div></div>'})();var page='bookmark';var bookmarkData=[];var randomData=[];var searchData=[];var userData={};var addData=[];var bookmarkViewMode='normal';var loadCount=0;var viewCount=18;var illustLoadMargin=0;var bookmarkAddPage='';var bookmarkAddPageCount=1;var reading=!1;var container;window.onscroll=()=>{if(page=='bookmark'){appendItemToBottom()}};function resetHTML(){if(pc){var removeDiv=document.querySelectorAll('#root>div:nth-child(2)>div>div:nth-child(2)>div');for(var i=0;i<removeDiv.length;i++){removeDiv[i].parentNode.removeChild(removeDiv[i])}
var addStyle=document.createElement('style');var rule=document.createTextNode(pbvStyle);addStyle.media='screen';addStyle.type='text/css';addStyle.appendChild(rule);document.head.appendChild(addStyle);container=document.createElement('div');container.id='pbvContainer';container.style.margin='0 auto 96px';container.style.maxWidth='1224px';container.innerHTML=pbvBookmarkHTML;document.querySelector('#root>div:nth-child(2)>div>div:nth-child(2)').appendChild(container)}
else{var addStyle=document.createElement('style');var rule=document.createTextNode(pbvStyle);addStyle.media='screen';addStyle.type='text/css';addStyle.appendChild(rule);document.head.appendChild(addStyle);container=document.querySelector('#contents>div>div:nth-child(2)>div:nth-child(5)');container.id='pbvContainer';container.innerHTML=pbvBookmarkHTML}
var nav=container.previousElementSibling;nav.id='pbvNav'
nav.innerHTML=pbvNav;var navBookmark=document.getElementById('navBookmark');var navOption=document.getElementById('navOption');navBookmark.addEventListener('click',()=>{if(page=='bookmark')return;navBookmark.classList.add('active');navOption.classList.remove('active');page='bookmark';changePage();setEvent()},!1);navOption.addEventListener('click',()=>{if(page=='option')return;navOption.classList.add('active');navBookmark.classList.remove('active');page='option';changePage();setEvent()},!1)}
function changePage(){if(page=='bookmark'){container.innerHTML=pbvBookmarkHTML;bookmarkViewMode='normal';loadCount=0;addItem()}
else{container.innerHTML=pbvOptionHTML;bookmarkPage='';bookmarkAddPage='';bookmarkAddPageCount=1;reading=!1;document.getElementById("optionTextarea").placeholder="「データの表示」　ここに現在のデータを表示します。\r\n\r\n"+"「データの上書き」　ここに書かれたデータを現在のデータに上書きします。\r\n\r\n"+"「データの読み込み」　ここに書かれたURLのファイル内容を現在のデータに上書きします。（dropboxの共有URLでも可）"}};var iframeTimer;function setEvent(){if(page=='bookmark'){clearInterval(iframeTimer);var element;element=document.getElementById('radioNormal');element.addEventListener('click',()=>{bookmarkViewMode='normal';loadCount=0;document.getElementById('itemList').innerHTML=null;createSearchData().then(addItem())},!1);element=document.getElementById('radioRandom');element.addEventListener('click',()=>{bookmarkViewMode='random';loadCount=0;document.getElementById('itemList').innerHTML=null;createRandomData().then(createSearchData()).then(addItem())},!1);element=document.getElementById('inputSearch');element.addEventListener('change',()=>{loadCount=0;document.getElementById('itemList').innerHTML=null;createSearchData().then(addItem())},!1);element=document.getElementById('searchBut');element.addEventListener('click',()=>{loadCount=0;document.getElementById('itemList').innerHTML=null;createSearchData().then(addItem())},!1)}
else{iframeTimer=setInterval(()=>{changeBookmarkAddPageCount()},1000);var element;element=document.getElementById('jumpPageCount');element.addEventListener('click',()=>{bookmarkAddPageChange()},!1);element=document.getElementById('jumpOldPage');element.addEventListener('click',()=>{bookmarkAddPage='old';bookmarkAddPageChange()},!1);element=document.getElementById('jumpNewPage');element.addEventListener('click',()=>{bookmarkAddPage='new';bookmarkAddPageChange()},!1);element=document.getElementById('bookmarkReadStrat');element.addEventListener('click',()=>{var iframe=document.getElementById('iframeBookmark');var url=iframe.contentWindow.location.href;if(url=='about:blank')return;if(reading==!1){reading=!0;var overlay=document.querySelector('#pbvContainer .overlay');overlay.classList.remove('none');var but=document.getElementById('bookmarkReadStrat');but.textContent='中止';addData=[];bookmarkAddPageCount++;clearInterval(iframeTimer);iframeTimer=setInterval(()=>{readBookmarkPageData()},1500)}
else{reading=!1;var overlay=document.querySelector('#pbvContainer .overlay');overlay.classList.add('none');var but=document.getElementById('bookmarkReadStrat');but.textContent='開始';clearInterval(iframeTimer);iframeTimer=setInterval(()=>{changeBookmarkAddPageCount()},1000)}},!1);element=document.getElementById('butDataShow');element.addEventListener('click',()=>{showBookmarkData()},!1);element=document.getElementById('butDataOverwrite');element.addEventListener('click',()=>{overwriteBookmarkData()},!1);element=document.getElementById('butDownloadData');element.addEventListener('click',()=>{downloadData()},!1);element=document.getElementById('butLoadWithAjax');element.addEventListener('click',()=>{loadDataWithAjax()},!1)}};function loadToLocalStorage(){return new Promise(function(resolve,reject){var data=JSON.parse(localStorage.getItem('pbv'));if(!isObject(data))data={};bookmarkData=(()=>{if(data.bookmark)return data.bookmark;return[]})();userData=(()=>{if(data.user)return data.user;return{}})();resolve()})}
function saveToLocalStorage(){return new Promise(function(resolve){var data={"bookmark":bookmarkData,"user":userData};localStorage.setItem('pbv',JSON.stringify(data));resolve()})}
function getParameter(url){var arg={};var pair=url.split('?')[1].split('&');for(var i=0;pair[i];i++){var kv=pair[i].split('=');arg[kv[0]]=kv[1]}
return arg}
function getData(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){resolve(xhr.responseText)}
else{reject(Error(xhr.statusText))}}};xhr.onerror=function(){reject(Error("Network Error"))};xhr.open('GET',url);xhr.send(null)})}
function isObject(o){return(o instanceof Object&&!(o instanceof Array))?!0:!1};function formatTime(date,format){format=format.replace(/YYYY/,date.getFullYear());format=format.replace(/MM/,zeroPadding(date.getMonth()+1,2));format=format.replace(/DD/,zeroPadding(date.getDate(),2));format=format.replace(/hh/,zeroPadding(date.getHours(),2));format=format.replace(/mm/,zeroPadding(date.getMinutes(),2));format=format.replace(/ss/,zeroPadding(date.getSeconds(),2));return format}
function zeroPadding(str,count){var herd=new Array(count+1).join('0');return(herd+str).slice(0-count)}
resetHTML();setEvent();loadToLocalStorage().then(saveToLocalStorage());function addItem(){try{for(var i=0;i<viewCount;i++){var index=i+(loadCount*viewCount);var data=(()=>{if(bookmarkViewMode=='normal')return bookmarkData[index];if(bookmarkViewMode=='random')return randomData[index];return searchData[index]})();createItem(data)}}
catch(e){console.error(e)}};function createItem(data){if(data==undefined)return;var isCount=(()=>{if(data.count=='1')return'display: none;';return''})();var isR18=(()=>{var b=data.tags.some((value)=>{return value=='R-18'||value=='R-18G'});if(!b)return'display: none;';return''})();var r18Text=(()=>{if(isR18!='')return'';var b=data.tags.some((value)=>{return value=='R-18'});if(b)return'R-18';return'R-18G'})();var isUgoku=(()=>{if(data.ugoku)return'';return'display: none;'})();var itemList=document.getElementById('itemList');var child=(()=>{if(pc)return document.createElement('li');return document.createElement('div')})();child.classList.add('item');child.innerHTML=(()=>{if(pc){return'<div>'+'  <div>'+'    <div>'+'      <a href="https://www.pixiv.net/member_illust.php?mode=medium&illust_id='+data.id+'" target="_blank">'+'        <div>'+'          <div style="'+isR18+'">'+'            <div>'+'              <div>'+r18Text+'</div>'+'            </div>'+'          </div>'+'          <div style="'+isCount+'">'+'            <svg>'+'              <path d="M8,3 C8.55228475,3 9,3.44771525 9,4 L9,9 C9,9.55228475 8.55228475,10 8,10 L3,10 C2.44771525,10 2,9.55228475 2,9 L6,9 C7.1045695,9 8,8.1045695 8,7 L8,3 Z M1,1 L6,1 C6.55228475,1 7,1.44771525 7,2 L7,7 C7,7.55228475 6.55228475,8 6,8 L1,8 C0.44771525,8 0,7.55228475 0,7 L0,2 C0,1.44771525 0.44771525,1 1,1 Z"></path>'+'            </svg>'+'            <span>'+data.count+'</span>'+'          </div>'+'        </div>'+'        <div style="background-image: url(https://i.pximg.net/c/250x250_80_a2/img-master/img/'+data.imageUrl+');">'+'          <svg viewBox="0 0 24 24" style="'+isUgoku+'">'+'            <circle cx="12" cy="12" r="10"></circle>'+'            <path d="M9,8.74841664 L9,15.2515834 C9,15.8038681 9.44771525,16.2515834 10,16.2515834 C10.1782928,16.2515834 10.3533435,16.2039156 10.5070201,16.1135176 L16.0347118,12.8619342 C16.510745,12.5819147 16.6696454,11.969013 16.3896259,11.4929799 C16.3034179,11.3464262 16.1812655,11.2242738 16.0347118,11.1380658 L10.5070201,7.88648243 C10.030987,7.60646294 9.41808527,7.76536339 9.13806578,8.24139652 C9.04766776,8.39507316 9,8.57012386 9,8.74841664 Z"></path>'+'          </svg>'+'        </div>'+'      </a>'+'    </div>'+'  </div>'+'  <a href="https://www.pixiv.net/member_illust.php?mode=medium&illust_id='+data.id+'" target="_blank">'+data.title+'</a>'+'  <div>'+'    <div>'+'      <a href="https://www.pixiv.net/member.php?id='+data.userId+'" target="_blank" style="background-image: url('+data.userIconUrl+');"></a>'+'    </div>'+'    <a href="https://www.pixiv.net/member.php?id='+data.userId+'" target="_blank">'+data.user+'</a>'+'  </div>'+'</div>'}
return'<div>'+'  <a href="https://www.pixiv.net/member_illust.php?mode=medium&illust_id='+data.id+'" target="_blank">'+'    <div>'+'      <div class="square"></div>'+'      <div class="image" style="background-image: url(https://i.pximg.net/c/540x540_70/img-master/img/'+data.imageUrl+');">'+'        <div class="r18" style="'+isR18+'">'+'          <span>R-18</span>'+'        </div>'+'        <div class="count" style="'+isCount+'">'+'          <img src="https://s.pximg.net/touch/touch/js/bundle/3aae66ac7716524f2fe9a06e93437786.svg">'+'          <span>'+data.count+'</span>'+'        </div>'+'        <div class="ugoku" style="'+isUgoku+'">'+'          <img src="https://s.pximg.net/touch/touch/js/bundle/4f2163600b6b407f10d6c835140d1fcb.svg">'+'        </div>'+'      </div>'+'    </div>'+'  </a>'+'</div>'})();itemList.appendChild(child)};function appendItemToBottom(){if(pc){var bottomElement=document.querySelector('#itemList .item:last-child');if(!bottomElement)return;var screenBottom=(documentElement.scrollTop+documentElement.clientHeight);var lastItemOffset=(bottomElement.offsetTop-documentElement.offsetTop);if(lastItemOffset<(screenBottom+illustLoadMargin)){loadCount++;addItem()}}
else{var scrollTop=document.body.scrollTop||document.documentElement.scrollTop;var clientHeight=document.body.clientHeight;var scrollHeight=document.body.scrollHeight||document.docomentElement.scrollHeight;if(scrollHeight===clientHeight){clientHeight=window.innerHeight}
var remain=scrollHeight-clientHeight-scrollTop;if(remain<=200){loadCount++;addItem()}}}
function createRandomData(){return new Promise(function(resolve,reject){randomData=JSON.parse(JSON.stringify(bookmarkData));for(var i=randomData.length-1;i>0;i--){var r=Math.floor(Math.random()*(i+1));var tmp=randomData[i];randomData[i]=randomData[r];randomData[r]=tmp}
resolve()})}
function createSearchData(){return new Promise(function(resolve,reject){searchData=[];var searchBox=document.getElementById('inputSearch').value;if(searchBox==''){bookmarkViewMode=(()=>{if(document.getElementById('radioRandom').checked)return'random';return'normal'})();resolve();return}
var arr=[];if(document.getElementById('radioRandom').checked){arr=randomData}
else{arr=bookmarkData}
var searchTexts=searchBox.replace(/\s/g,' ').split(' ');var matcher;if(!/^\/.*\/$/.test(searchBox)){var condition=[[]];for(var i=0;i<searchTexts.length;i++){if(searchTexts[i]!='AND'&&searchTexts[i]!='OR'&&searchTexts[i]!='NOT'){if(searchTexts[i-1]=='OR'){condition.push([searchTexts[i]])}
else if(searchTexts[i-1]=='NOT'){condition[condition.length-1].push('-'+searchTexts[i])}
else{condition[condition.length-1].push(searchTexts[i])}}}
var compile=function(cond){var joinAnd=function(arr){return'^(?=[\\s\\S]*'+arr.join(')(?=[\\s\\S]*')+')'};var joinOr=function(arr){return'(?:'+arr.join('|')+')'};var escape=function(str){return str.replace(/(?=[(){}\[\].*\\^$?])/,'\\')};var rx=joinOr(cond.map(function(inner){return joinAnd(inner.map(escape))}));rx=rx.replace(/=\[\\s\\S\]\*-/g,'![\\s\\S]*');return new RegExp(rx)};matcher=compile(condition)}
else{matcher=new RegExp(searchBox.slice(1,-1))}
for(var i=0;i<arr.length;i++){var testStr=arr[i].title+' '+arr[i].user+' '+arr[i].tags.join(' ');if(matcher.test(testStr)){searchData.push(arr[i])}}
bookmarkViewMode='search';resolve()})}
addItem();createRandomData();function bookmarkAddPageChange(){bookmarkAddPageCount=document.getElementById('inputPageCount').value;var url=(()=>{if(bookmarkAddPage=='old')return'https://www.pixiv.net/bookmark.php?rest=show&p='+bookmarkAddPageCount;if(bookmarkAddPage=='new')return'https://www.pixiv.net/bookmark.php?id=9791957&rest=show&p='+bookmarkAddPageCount;return''})();if(url=='')return;var iframeBookmark=document.getElementById('iframeBookmark');if(pc){iframeBookmark.src=url}
else{iframeBookmark.src='https://www.pixiv.net/redirect_pc.php';setTimeout(function(){iframeBookmark.src=url},1000)}}
function changeBookmarkAddPageCount(){var iframe=document.getElementById('iframeBookmark');var url=iframe.contentWindow.location.href;if(url=='about:blank')return!1;var parameter=getParameter(url);var p=(()=>{if(parameter.p)return+parameter.p;return 1})();if(p==bookmarkAddPageCount)return!1;bookmarkAddPageCount=p;var inputPageCount=document.getElementById('inputPageCount');inputPageCount.value=p;return p}
function readBookmarkPageData(){var p=changeBookmarkAddPageCount();if(!p)return;var iframe=document.getElementById('iframeBookmark');var iframeDoc=iframe.contentWindow.document;var lastFlag=!1;if(bookmarkAddPage=='old'){var imgItem=iframeDoc.querySelectorAll('.js-legacy-mark-unmark-list .image-item');if(imgItem.length==0)lastFlag=!0;for(var i=0;imgItem[i];i++){try{var imgElement=imgItem[i].getElementsByClassName('ui-scroll-view')[0];var data={};data.id=imgElement.getAttribute('data-id');data.title=imgItem[i].getElementsByClassName('title')[0].getAttribute('title');data.user=imgItem[i].getElementsByClassName('user')[0].getAttribute('data-user_name');data.userId=imgItem[i].getElementsByClassName('user')[0].getAttribute('data-user_id');data.count=(()=>{if(imgItem[i].querySelector('.page-count span'))return imgItem[i].querySelector('.page-count span').textContent;return'1'})();data.imageUrl=imgElement.getAttribute('data-src').replace(/^.+?img\/(.+?)master(.+?)$/,'$1square$2');data.userIconUrl='';data.ugoku=imgItem[i].getElementsByClassName('work')[0].classList.contains('ugoku-illust');data.tags=imgElement.getAttribute('data-tags').split(' ');addData.push(data);if(userData[data.userId]==null){userData[data.userId]={"name":data.user,"icon":""}}
else{userData[data.userId].name=data.user}}
catch(e){console.error(e)}}}
else{var imgItem=iframeDoc.querySelectorAll('div[role]');for(var i=1;imgItem[i];i++){try{var a=imgItem[i].parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByTagName('a');var id=a[2].href.match(/(\w+)$/)[1];userData[id]={"name":a[3].textContent,"icon":window.getComputedStyle(imgItem[i],null).getPropertyValue('background-image').match(/\("(.+?)"\)/)[1]}}
catch(e){console.error(e)}}}
if(checkConnectData()||lastFlag){new Promise(resolve=>{if(bookmarkAddPage=='old'){if(!lastFlag){addBookmarkData()}
else{bookmarkData=addData}}
resolve()}).then(setUserData()).then(saveToLocalStorage()).then(()=>{document.getElementById('bookmarkReadStrat').click()})}
else{p++;var url=(()=>{if(bookmarkAddPage=='old')return'https://www.pixiv.net/bookmark.php?rest=show&p='+p;if(bookmarkAddPage=='new')return'https://www.pixiv.net/bookmark.php?id=9791957&rest=show&p='+p;return''})();iframe.src=url}}
function checkConnectData(){if(bookmarkData.length<1)return!1;var result=addData.some(value=>{return value.id===bookmarkData[0].id});return result}
function addBookmarkData(){if(bookmarkData.length<1)return;var overIndex=addData.length;for(var i=0;i<addData.length;i++){if(addData[i].id==bookmarkData[0].id){overIndex=i}}
addData.splice(overIndex,addData.length-overIndex);bookmarkData=addData.concat(bookmarkData)}
function setUserData(){new Promise(function(resolve,reject){if(bookmarkData==[])return;for(key in userData){bookmarkData.forEach((e)=>{if(e.userId==key){if(e.user!=userData[key].name)e.user=userData[key].name;if(e.userIconUrl!=userData[key].icon)e.userIconUrl=userData[key].icon}})}
resolve()})}
function showBookmarkData(){var confirm=window.confirm('データを表示します。');if(!confirm)return;loadToLocalStorage().then(saveToLocalStorage()).then(()=>{var optionTextarea=document.getElementById('optionTextarea');optionTextarea.value=localStorage.getItem('pbv')})}
function overwriteBookmarkData(){var confirm=window.confirm('データを上書きします。');if(!confirm)return;var optionTextarea=document.getElementById('optionTextarea');var data;new Promise(function(resolve,reject){data=JSON.parse(optionTextarea.value);localStorage.setItem('pbv',JSON.stringify(data));resolve()}).then(loadToLocalStorage()).then(saveToLocalStorage()).then(()=>{optionTextarea.value='完了'}).catch(err=>{optionTextarea.value='データが無効です。';console.error(e)})}
function downloadData(){window.alert('申し訳ございません。工事中です。');return;var confirm=window.confirm('データをダウンロードします。');if(!confirm)return;loadToLocalStorage().then(saveToLocalStorage()).then(()=>{var base64=window.btoa(unescape(encodeURIComponent(localStorage.getItem('pbv'))));var url='data:text/plain;charset=utf-8;base64,'+base64;var fileName=formatTime(new Date,'YYYY_MM_DD');var a=document.createElement('a');a.href=url;a.download=fileName+'.txt';a.click()})}
function loadDataWithAjax(){var confirm=window.confirm('データを読み込みます。');if(!confirm)return;var optionTextarea=document.getElementById('optionTextarea');var url=optionTextarea.value.replace(/(\r|\n|\r\n)/g,'');if(optionTextarea.value==''){optionTextarea.value='URLが無効です。';return}
if(/https\:\/\/www\.dropbox\.com\/s\/.+?\?dl=0/.test(url)){url=url.replace(/^(.+?)www\.dropbox\.com(.+?)\?dl=0$/,'$1dl.dropboxusercontent.com$2')}
getData(url).then(res=>{new Promise(function(resolve,reject){var data=JSON.parse(res);if(!isObject(data)){reject();return}
bookmarkData=(()=>{if(data.bookmark)return data.bookmark;return[]})();userData=(()=>{if(data.user)return data.user;return{}})();resolve()}).then(saveToLocalStorage()).then(()=>{optionTextarea.value='完了'}).catch(err=>{optionTextarea.value='データが無効です。';console.error(err)})},err=>{optionTextarea.value='URLが無効です。';console.error(err)})}})()

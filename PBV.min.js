(()=>{!function(e){"use strict";var t=void 0,i=function(e,t){"function"==typeof e&&e(t)};try{e.indexedDB=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.OIndexedDB||e.msIndexedDB}catch(e){}var n=null;e.indexedDB!=t&&(n=function(){var e="DbStorageByLocalTable",n=null,a={},o=function(){try{return n.transaction(e,"readwrite")}catch(e){console.log("error getTransaction(rw):"+e)}},r=!1,d=function(i){var a=r;r=!0,a?i!=t&&i():function(i){var a=indexedDB.open("dbLocalStorage",100);a.onupgradeneeded=function(t){console.log("### [indexedDB] upgradeneeded");try{var i=a.result;i.transaction.onerror=function(e){console.log("error indexedDB(init[onupgradeneeded])",e)},i.objectStoreNames.contains(e)&&i.deleteObjectStore(e),i.createObjectStore(e,{keyPath:"pkey",autoIncrement:!1})}catch(e){console.log("error init[onupgradeneeded]:"+e)}},a.onsuccess=function(e){console.log("### [indexedDB] success");try{n=e.target!=t&&null!=e.target?e.target.result:e.result}catch(e){n=null,console.log("error init[onsuccess]:"+e)}i!=t&&i()}}(i)};return a.clear=function(t){d(function(){!function(t,n){try{t.objectStore(e).clear(),t.oncomplete=function(){i(n,!0)},t.onabort=t.onerror=function(){i(n,!1)}}catch(e){console.log("error clear:"+e),i(n,!1)}}(o(),t)})},a.add=a.put=function(t,n,a){d(function(){!function(t,n,a,o){try{var r=t.objectStore(e),d={};d.pkey=""+n,d.value=""+a,r.put(d),t.oncomplete=function(){i(o,!0)},t.onabort=t.onerror=function(){i(o,!1)}}catch(e){console.log("error add:"+e),i(o,!1)}}(o(),t,n,a)})},a.remove=function(t,n){d(function(){!function(t,n,a){try{t.objectStore(e).delete(""+n),t.oncomplete=function(){i(a,!0)},t.onabort=t.onerror=function(){i(a,!1)}}catch(e){console.log("erro delete:"+e),i(a,!1)}}(o(),t,n)})},a.get=function(a,o){d(function(){!function(n,a,o){try{var r=n.objectStore(e).get(""+a);r.onsuccess=function(){var e=r.result;e==t||null==e?e="":e.value!=t&&null!=e.value||(e.value=""),i(o,e.value)},r.onerror=function(){i(o,null)}}catch(e){console.log("error get:"+e),i(o,null)}}(function(){try{return n.transaction(e,"readonly")}catch(e){console.log("error getTransaction(r):"+e)}}(),a,o)})},a.type=function(){return d(),"indexedDB"},a});var a=null;e.openDatabase!=t&&(a=function(){var e="DbStorageByLocalTable",n=openDatabase("dbLocalStorage","1.0","dbLocalStorage",5242880),a={},o=function(t,n){t.executeSql("create table if not exists "+e+" (id TEXT NOT NULL PRIMARY KEY UNIQUE ,value TEXT)",[],function(){i(n,!0)},function(){i(n,!1)})},r=function(t,n,a){t.executeSql("DELETE FROM "+e+" WHERE id=?",[""+n],function(){i(a,!0)},function(){i(a,!1)})},d=!1,l=function(e){var i=d;d=!0,i?e!=t&&e():n.transaction(function(i){o(i),e!=t&&e()})};return a.clear=function(t){l(function(){n.transaction(function(n){!function(t,n){t.executeSql("drop table "+e,[],function(){i(n,!0)},function(){i(n,!1)})}(n,function(){o(n,t)})})})},a.add=a.put=function(t,a,o){l(function(){n.transaction(function(n){r(n,t,function(){!function(t,n,a,o){t.executeSql("INSERT INTO "+e+" VALUES ( ?, ? )",[""+n,""+a],function(){i(o,!0)},function(){i(o,!1)})}(n,t,a,o)})})})},a.remove=function(e,t){l(function(){n.transaction(function(i){r(i,e,t)})})},a.get=function(t,a){l(function(){n.transaction(function(n){n.executeSql("SELECT value FROM "+e+" WHERE id=? limit 1",[t],function(e,t){if(1!=t.rows.length)i(a,null);else{var n=t.rows.item(0);i(a,n.value)}})})})},a.type=function(){return l(),"webDB"},a});var o,r,d=null;null!=n?d=n():null!=a?d=a():(r={},(o={}).clear=function(e){r={},i(e,!0)},o.add=o.put=function(e,t,n){r[""+e]=t,i(n,!0)},o.remove=function(e,t){delete r[""+e],i(t,!0)},o.get=function(e,t){var n=r[""+e];i(t,n)},o.type=function(){return"memory"},d=o),e.dbStorage=d}(window);var t,i,n=(()=>!!document.getElementById("root"))(),a=(()=>navigator.userAgent.toLowerCase().match(/webkit|msie 5/)?-1!=navigator.userAgent.indexOf("Chrome")?document.documentElement:document.body:document.documentElement)(),o=(()=>n?'#pbvContainer .flex{display:flex}#pbvContainer .none{display:none}#pbvContainer .aBut{display:block;margin:auto 0 auto 5px;padding:3px 6px;border-radius:16px;background-color:#eee;color:#666;cursor:pointer;text-align:center;text-decoration:none}#pbvContainer a{cursor:pointer}#pbvNav .navContents{margin-top:-1px;padding:13px 16px 16px;font-weight:700;font-size:16px;color:#999;text-decoration:none;border-top:4px solid transparent;-webkit-transition:color .2s;transition:color .2s}#pbvNav .navContents:hover{color:#333}#pbvNav .navContents.active{border-top:4px solid #0096fa;color:#333}#pbvMenu{margin:30px 0;padding:0}#pbvContainer .mode label{display:block;margin:auto 5px auto 0;cursor:pointer}#pbvContainer .mode input[type=radio]{cursor:pointer}#pbvContainer .mode input[type=text]{-webkit-box-flex:0;-webkit-flex:none;flex:none;padding:3px 5px;width:163px;height:20px;border:1px solid #becad7;font-size:14px;line-height:1;color:#555;border-radius:0;outline:0;-webkit-appearance:none;background-color:#fff}#searchBut{-webkit-box-flex:0;-webkit-flex:none;flex:none;width:50px;height:28px;background-color:#becad7;background-image:url(https://s.pximg.net/www/js/spa/00545159b33bfc46a2dc0eff7ef34f5b.png);background-position:50%;background-repeat:no-repeat;background-size:16px 16px;border:none;cursor:pointer}#searchBut:hover{background-color:#ced7e1}#itemList{margin:0 -12px -24px;padding:0;display:flex;flex-wrap:wrap;align-content:flex-start;list-style:none}#itemList li{margin:0 12px 24px}#itemList li>div{width:184px;margin:0}#itemList li>div>div:nth-child(1){position:relative;margin-bottom:4px}#itemList li>div>div:nth-child(1)>div{position:relative;width:184px;height:184px}#itemList li>div>div:nth-child(1)>div>a{text-decoration:none}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1){position:absolute;top:0;left:0;right:0;box-sizing:border-box;display:flex;z-index:1;padding:4px 4px 0}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(1){display:flex;flex-flow:row wrap}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(1)>div{margin:2px}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(1)>div>div{color:rgb(255,255,255);font-weight:700;font-size:10px;line-height:1;padding:3px 6px;border-radius:3px;background:rgb(255,64,96)}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(2){display:flex;-webkit-box-align:center;align-items:center;box-sizing:border-box;margin-left:auto;height:20px;color:rgb(255,255,255);font-size:10px;line-height:12px;font-weight:700;flex:0 0 auto;padding:4px 6px;background:rgba(0,0,0,.32);border-radius:10px}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(2)>svg{stroke:none;line-height:0;font-size:0;width:9px;height:10px;fill:currentcolor}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(1)>div:nth-child(2)>span{margin-left:2px}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2){display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;width:100%;height:100%;background-size:cover;background-color:rgb(255,255,255);border-radius:4px;background-position:center center;background-repeat:no-repeat}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2)::before{content:"";position:absolute;display:block;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.02)}#itemList li>div>div:nth-child(1)>div>a:hover>div:nth-child(2){opacity:.8}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2)>svg{width:48px;height:48px;stroke:none;fill:rgb(255,255,255);line-height:0;font-size:0;vertical-align:middle}#itemList li>div>div:nth-child(1)>div>a>div:nth-child(2)>svg circle{fill:rgb(0,0,0);fill-opacity:.4}#itemList li>div>a:nth-child(2){display:inline-block;max-width:100%;text-overflow:ellipsis;white-space:nowrap;line-height:22px;font-size:14px;font-weight:700;color:rgb(31,31,31);overflow:hidden;text-decoration:none;transition:color 0.2s ease 0s}#itemList li>div>a:nth-child(2):visited{color:rgb(173,173,173)}#itemList li>div>a:nth-child(2):hover{color:rgb(92,92,92)}#itemList li>div>div:nth-child(3){display:flex;-webkit-box-align:center;align-items:center;width:100%}#itemList li>div>div:nth-child(3)>div{margin-right:4px}#itemList li>div>div:nth-child(3)>div>a{position:relative;display:block;width:16px;height:16px;border-radius:50%;background-size:cover;background-position:top;-webkit-box-flex:0;-webkit-flex:none;flex:none}#itemList li>div>div:nth-child(3)>div>a:before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.02)}#itemList li>div>div:nth-child(3)>a{display:inline-block;line-height:16px;font-size:12px;color:rgb(173,173,173);text-overflow:ellipsis;white-space:nowrap;text-decoration:none;overflow:hidden}#setInfo .title{text-align:center}#setInfo .title h1{margin:5px 0}#setInfo .title h2{margin:5px 0;font-size:18px}#setInfo .imageContainer{padding:20px;background:#fafafa;border-radius:5px}#setInfo .mainImage{text-align:center}#setInfo .mainImage img{max-width:100%;max-height:480px;cursor:pointer}#setInfo .mainImage img.large{max-height:100%}#setInfo .imageList{overflow-x:auto;overflow-y:visible}#setInfo .imageList .container{display:flex;margin:auto;padding:10px 80px 0}#setInfo .imageList .container div{width:144px;height:144px;margin:0 4px;background-size:cover;background-color:rgb(255,255,255);border-radius:4px;background-position:center center;background-repeat:no-repeat}#setInfo .imageList .container div.selected{opacity:.5}#setInfo .formContainer{margin:20px 0 0;display:flex}#setInfo .formContainer .works>div,#setInfo .formContainer .tag>div{margin:10px 0;padding:13px 20px;line-height:24px;background:#fafafa;border-radius:5px}#setInfo .formContainer .works{flex-grow:1}#setInfo .formContainer .works dl{margin:0;display:flex}#setInfo .formContainer .works dt{width:180px}#setInfo .formContainer .works dd{margin:0;flex-grow:1}#setInfo .formContainer .works dd ul{margin:0;padding:0;display:flex;list-style-type:none}#setInfo .formContainer .works dd>ul + ul{margin:8px 0 0}#setInfo .formContainer .works dd ul li{margin:0 40px 0 0}#setInfo .formContainer .works dd ul.smallMargin li{margin:0 10px 0 0}#setInfo .formContainer .works dd ul li input[type="checkebox"],#setInfo .formContainer .works dd ul li input[type="radio"]{margin:0 4px 0 0}#setInfo .formContainer .works dd ul.impressionsList{flex-wrap:wrap}#setInfo .formContainer .works dd ul.impressionsList li{color:#5e9ece}#setInfo .impressionsInput select{min-width:100px}#setInfo .formContainer .tag{margin-left:20px;width:430px}#setInfo .formContainer .tag .tagConatiner dl{display:flex}#setInfo .formContainer .tag .tagConatiner dt{flex-grow:1}#setInfo .formContainer dt span{color:#5e9ece}#setInfo .formContainer dt span.typeTitle{color:red}#setInfo .formContainer dt span.typeCharacter{color:#0a0}#setInfo .formContainer dt span.typeUsers{color:#a0a}#iframeBookmark{margin:16px 0}#bookmarkReadStrat{padding:8px 14px;z-index:5}#pbvContainer .overlayContainer{position:relative;padding:10px 0}#pbvContainer .overlay{position:absolute;left:-1%;width:102%;height:100%;z-index:2;background:rgba(0,0,0,.2)}#dataOption .textareaContainer{width:100%;height:320px}#optionTextarea{width:100%;height:100%}#dataOption .butContainer{margin:20px 0;padding:0 0 10px 0}#dataOption .aBut{margin:auto 5px auto 0}':'#pbvContainer .flex {display: flex;flex-wrap: wrap;}#pbvContainer .none {display: none;}#pbvContainer .aBut {display: block;margin: auto 0 auto 5px;padding: 3px 6px;border-radius: 16px;background-color: #eee;color: #666;cursor: pointer;text-align: center;text-decoration: none;}#pbvMenu {margin: 30px 0;padding: 0;}#pbvContainer .mode label {margin: auto 5px auto 0;cursor: pointer;}#pbvContainer .mode input {cursor: pointer;}#searchBut {-webkit-box-flex: 0;-webkit-flex: none;flex: none;width: 50px;height: 32px;margin: auto;background-color: #becad7;background-image: url("https://s.pximg.net/www/js/spa/00545159b33bfc46a2dc0eff7ef34f5b.png");background-position: 50%;background-repeat: no-repeat;background-size: 16px 16px;border: none;cursor: pointer;}#itemList>div {width: 50%;display: inline-block;position: relative;}#itemList>div>div {display: inline-block;box-sizing: border-box;position: relative;width: 100%;vertical-align: bottom;}#itemList>div>div>a>div {width: 100%;height: 100%;position: relative;background: #fff;overflow: hidden;}#itemList>div>div>a>div>div.square {display: block;height: 0;width: 100%;padding-bottom: 100%;opacity: 0;}#itemList>div>div>a>div>div.image {position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-size: cover;}#itemList>div>div>a>div>div.image>div.count {position: absolute;top: 4px;right: 4px;display: inline-block;margin: 0;padding: 0 6px;line-height: 19px;color: #fff;background: rgba(0,0,0,.4);border-radius: 20px;font-size: 10px;font-weight: 700;}#itemList>div>div>a>div>div.image>div.count>img {vertical-align: middle;height: 9px;margin-right: 3px;}#itemList>div>div>a>div>div.image>div.r18 {position: absolute;top: 2px;left: 4px;display: inline-block;}#itemList>div>div>a>div>div.image>div.r18>span {display: inline-block;font-size: 10px;line-height: 10px;font-weight: 700;padding: 3px 6px;border-radius: 3px;color: rgb(255, 255, 255);background: rgb(255, 64, 96);}#itemList>div>div>a>div>div.image>div.ugoku {position: absolute;top: 50%;left: 50%;-webkit-transform: translateX(-50%) translateY(-50%);transform: translateX(-50%) translateY(-50%);}#itemList>div>div>a>div>div.image>div.ugoku>img {position: absolute;top: 50%;left: 50%;height: 45%;-webkit-transform: translateX(-37.5%) translateY(-50%);transform: translateX(-37.5%) translateY(-50%);}#bookmarkAdd .aBut {margin: 5px;flex-grow: 1;}#bookmarkAdd label {margin: auto;}#bookmarkAdd .iframeContainer {width: 100%;height: 320px;margin: 16px 0;overflow: scroll;}#pbvContainer .overlayContainer {position: relative;padding: 10px 0;}#pbvContainer .overlay {position: absolute;left: -1%;width: 102%;height: 100%;z-index: 2;background: rgba(0,0,0,.2);}#bookmarkReadStrat {padding: 8px 14px;z-index: 5;}#dataOption .textareaContainer {width: 100%;height: 320px;}#optionTextarea {width: 100%;height: 100%;}#dataOption .butContainer {margin: 20px 0;padding: 0 0 10px 0;}#dataOption .aBut {margin: 8px;}')(),r='<a href="javascript:void(0);" id="navBookmark" class="navContents active">ブックマーク</a><a href="javascript:void(0);" id="navTag" class="navContents">タグ</a><a href="javascript:void(0);" id="navSetInfo" class="navContents">情報収集</a><a href="javascript:void(0);" id="navOption" class="navContents">オプション</a>',d=(()=>n?'<div id="setInfo"><div class="title"><h1><a href="#" target="_blank"></a></h1><h2><a href="#" target="_blank"></a></h2></div><div class="imageContainer"><div class="mainImage"></div><div class="imageList"><div class="container" style="width: calc(152px * 14)"></div></div></div><div class="formContainer"><div class="works"><h1>作品情報</h1><div class="worksType"><div><dl><dt>作品の種類</dt><dd><ul><li><label><input type="radio" name="worksType" value="0" checked>イラスト</label></li><li><label><input type="radio" name="worksType" value="1">うごイラ</label></li><li><label><input type="radio" name="worksType" value="2">マンガ</label></li></ul></dd></dl></div></div><div class="worksImpressions"><div><dl><dt>作品の感想</dt><dd><ul class="impressionsInput smallMargin"><li><select class="selectImpressions"><option value="0">かわいい</option><option value="0">かっこいい</option><option value="0">美しい</option><option value="0">オシャレ</option><option value="0">おもしろい</option><option value="0">ためになる</option><option value="0">エッチ</option><option value="0">エロい</option></select></li><li><input type="button" value="と思った"></li><li style="flex-grow: 2;"></li><li><span>感想一覧</span></li><li><input class="input_impressionsList" type="text" value=""></li></ul><ul class="impressionsList smallMargin"><li><a href="javascript:void(0);">かわいい</a></li><li><a href="javascript:void(0);">美しい</a></li></ul></dd></dl></div></div><div class="worksReview"><div><dl><dt>作品の評価</dt><dd><ul class="smallMargin"><li><span>☆ </span><span class="spanReview">0</span></li><li style="flex-grow: 2;"></li><li><input class="plus" type="button" value="＋"></li><li><input class="minus" type="button" value="－"></li></ul></dd></dl></div></div><div class="worksTarget manga"><div><dl><dt>作品の被写体</dt><dd><ul><li><label><input type="radio" name="worksTarget" value="0" checked>人物</label></li><li><label><input type="radio" name="worksTarget" value="1">その他</label></li></ul></dd></dl></div></div><div class="worksTargetSex noneHuman"><div><dl><dt>被写体の性別</dt><dd><ul><li><label><input type="radio" name="worksTargetSex" value="0">男性</label></li><li><label><input type="radio" name="worksTargetSex" value="1">女性</label></li><li><label><input type="radio" name="worksTargetSex" value="2" checked>両方</label></li></ul></dd></dl></div></div></div><div class="tag"><h1>タグ情報</h1><div class="tagConatiner"></div></div></div></div>':"")(),l=(()=>n?'<menu id="pbvMenu" class="flex"><div class="mode flex"><label><span>登録順</span><input type="radio" id="radioNormal" name="radioMode" checked></label><label><span>ランダム</span><input type="radio" id="radioRandom" name="radioMode"></label></div><input type="search" id="inputSearch" value="" placeholder="検索" style="flex-grow:1;"><div class="buttons flex"><a href="javascript:void(0);" id="searchBut"></a></div></menu><ul id="itemList"></ul>':'<menu id="pbvMenu"><div class="flex" style="flex-wrap:nowrap;"><input type="search" id="inputSearch" value="" placeholder="検索" style="flex-grow:1;"><a href="javascript:void(0);" id="searchBut"></a></div><div class="mode flex"><label><span>登録順</span><input type="radio" id="radioNormal" name="radioMode" checked></label><label><span>ランダム</span><input type="radio" id="radioRandom" name="radioMode"></label></div></menu><span id="itemList"></span>')(),s=(()=>n?'<div id="bookmarkAdd" class="overlayContainer"><div class="overlay none"></div><h2>ブックマークの読み込み</h2><div><div class="flex"><label><span>ページ数</span><input type="number" id="inputPageCount" value="1" min="1" max="9999"></label><a href="javascript:void(0);" id="jumpPageCount" class="aBut">移動</a><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="jumpOldPage" class="aBut">旧ブックマークページ</a><a href="javascript:void(0);" id="jumpNewPage" class="aBut">新ブックマークページ</a></div><iframe id="iframeBookmark" src="" width="100%" height="320px"></iframe></div><div class="mode flex"><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="bookmarkReadStrat" class="aBut" style="padding: 8px 14px;">開始</a></div></div><div id="dataOption"><h2>データの管理</h2><div class="textareaContainer"><textarea id="optionTextarea"></textarea></div><div class="butContainer flex"><a href="javascript:void(0);" id="butDataShow" class="aBut">データの表示</a><a href="javascript:void(0);" id="butDataSave" class="aBut">データの保存</a><a href="javascript:void(0);" id="butLoadWithAjax" class="aBut">データの読み込み</a><a href="javascript:void(0);" id="butGetDataWithApi" class="aBut">データの取得</a></div></div>':'<div id="bookmarkAdd" class="overlayContainer"><div class="overlay none"></div><h2>ブックマークの読み込み</h2><div class="flex"><a href="javascript:void(0);" id="jumpOldPage" class="aBut">旧ブックマークページ</a><a href="javascript:void(0);" id="jumpNewPage" class="aBut">新ブックマークページ</a></div><div class="flex"><label><span>ページ数</span><input type="number" id="inputPageCount" value="1" min="1" max="9999"></label><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="jumpPageCount" class="aBut">移動</a></div><div class="iframeContainer"><iframe id="iframeBookmark" src="" width="100%" height="320px"></iframe></div><div class="mode flex"><div style="flex-grow: 1;"></div><a href="javascript:void(0);" id="bookmarkReadStrat" class="aBut" style="padding: 8px 14px;">開始</a><div style="flex-grow: 1;"></div></div></div><div id="dataOption"><h2>データの管理</h2><div class="textareaContainer"><textarea id="optionTextarea"></textarea></div><div class="butContainer flex"><a href="javascript:void(0);" id="butDataShow" class="aBut">データの表示</a><a href="javascript:void(0);" id="butDataSave" class="aBut">データの保存</a><a href="javascript:void(0);" id="butLoadWithAjax" class="aBut">データの読み込み</a><a href="javascript:void(0);" id="butGetDataWithApi" class="aBut">データの取得</a></div></div>')(),c="bookmark",u=["bookmark","tag","setInfo","option"],p=[],v=[],m=[],g={},h=[],f="normal",x=0,b=18,w=0,y="",k=1,C=!1;function L(){if(c==u[0])clearInterval(i),document.getElementById("radioNormal").addEventListener("click",()=>{f="normal",x=0,document.getElementById("itemList").innerHTML=null,M().then(S())},!1),document.getElementById("radioRandom").addEventListener("click",()=>{f="random",x=0,document.getElementById("itemList").innerHTML=null,j().then(M()).then(S())},!1),document.getElementById("inputSearch").addEventListener("change",()=>{x=0,document.getElementById("itemList").innerHTML=null,M().then(S())},!1),document.getElementById("searchBut").addEventListener("click",()=>{x=0,document.getElementById("itemList").innerHTML=null,M().then(S())},!1);else if(c==u[1]);else if(c==u[2]){document.querySelector(".imageContainer .mainImage img").addEventListener("click",()=>{document.querySelector(".imageContainer .mainImage img").classList.toggle("large")},!1)}else if(c==u[3]){i=setInterval(()=>{P()},1e3),document.getElementById("jumpPageCount").addEventListener("click",()=>{O()},!1),document.getElementById("inputPageCount").addEventListener("keydown",e=>{13==e.keyCode&&O()},!1),document.getElementById("jumpOldPage").addEventListener("click",()=>{y="old",document.getElementById("inputPageCount").value=1,O()},!1),document.getElementById("jumpNewPage").addEventListener("click",()=>{y="new",document.getElementById("inputPageCount").value=1,O()},!1),document.getElementById("bookmarkReadStrat").addEventListener("click",()=>{"about:blank"!=document.getElementById("iframeBookmark").contentWindow.location.href&&(0==C?(C=!0,document.querySelector("#pbvContainer .overlay").classList.remove("none"),document.getElementById("bookmarkReadStrat").textContent="中止",h=[],k++,clearInterval(i),i=setInterval(()=>{!function(){var e=P();if(!e)return;var t=document.getElementById("iframeBookmark"),i=t.contentWindow.document,n=!1;if("old"==y){var a=i.querySelectorAll(".js-legacy-mark-unmark-list .image-item");0==a.length&&(n=!0);for(var o=0;a[o];o++)try{var r=a[o].getElementsByClassName("ui-scroll-view")[0],d={};d.id=+r.getAttribute("data-id"),d.title=a[o].getElementsByClassName("title")[0].getAttribute("title"),d.userId=+a[o].getElementsByClassName("user")[0].getAttribute("data-user_id"),d.count=(()=>a[o].querySelector(".page-count span")?+a[o].querySelector(".page-count span").textContent:1)(),d.img=r.getAttribute("data-src").match(/\d{4}\/\d{2}\/\d{2}\/\d{2}\/\d{2}\/\d{2}/)[0],d.ugoku=(()=>a[o].getElementsByClassName("work")[0].classList.contains("ugoku-illust")?1:0)(),d.tags=r.getAttribute("data-tags").split(" "),h.push(d),null==g[d.userId]?g[d.userId]={name:a[o].getElementsByClassName("user")[0].getAttribute("data-user_name"),icon:""}:g[d.userId].name=a[o].getElementsByClassName("user")[0].getAttribute("data-user_name")}catch(e){console.error(e)}}else{for(var a=i.querySelectorAll("div[role]"),o=1;a[o];o++)try{var l=a[o].parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByTagName("a"),s=l[2].href.match(/(\w+)$/)[1];g[s]={name:l[3].textContent,icon:l[2].querySelector("img").src}}catch(e){console.error(e)}e++;var c=(()=>"old"==y?"https://www.pixiv.net/bookmark.php?rest=show&p="+e:"new"==y?"https://www.pixiv.net/bookmark.php?id=9791957&rest=show&p="+e:"")();t.src=c}if(!(p.length<1)&&h.some(e=>e.id===p[0].id)||n||"old"!=y)new Promise(e=>{"old"==y&&(n?p=h:function(){if(p.length<1)return;for(var e=h.length,t=0;t<h.length;t++)h[t].id==p[0].id&&(e=t);h.splice(e,h.length-e),p=h.concat(p)}()),e()}).then(E()).then(()=>{document.getElementById("bookmarkReadStrat").click()});else{e++;var c=(()=>"old"==y?"https://www.pixiv.net/bookmark.php?rest=show&p="+e:"new"==y?"https://www.pixiv.net/bookmark.php?id=9791957&rest=show&p="+e:"")();t.src=c}}()},1500)):(C=!1,document.querySelector("#pbvContainer .overlay").classList.add("none"),document.getElementById("bookmarkReadStrat").textContent="開始",clearInterval(i),i=setInterval(()=>{P()},1e3)))},!1),document.getElementById("butDataShow").addEventListener("click",()=>{!function(){if(!window.confirm("データを表示します。"))return;var e={bookmark:p,user:g};e=JSON.stringify(e),document.getElementById("optionTextarea").value=e}()},!1),document.getElementById("butDataSave").addEventListener("click",()=>{!function(){if(!window.confirm("データを上書きします。"))return;var t=document.getElementById("optionTextarea");new Promise(function(e,i){var n=t.value;E(n),e()}).then(I()).then(()=>{t.value="完了"}).catch(i=>{t.value="データが無効です。",console.error(e)})}()},!1),document.getElementById("butLoadWithAjax").addEventListener("click",()=>{!function(){if(!window.confirm("データを読み込みます。"))return;var e=document.getElementById("optionTextarea"),t=e.value.replace(/(\r|\n|\r\n)/g,"");if(""==e.value)return void(e.value="URLが無効です。");/https\:\/\/www\.dropbox\.com\/s\/.+?\?dl=0/.test(t)&&(t=t.replace(/^(.+?)www\.dropbox\.com(.+?)\?dl=0$/,"$1dl.dropboxusercontent.com$2"));B(t).then(t=>{new Promise(function(e,i){E(t),e()}).then(I()).then(()=>{e.value="完了"}).catch(t=>{e.value="データが無効です。",console.error(t)})},t=>{e.value="URLが無効です。",console.error(t)})}()},!1),document.getElementById("butGetDataWithApi").addEventListener("click",()=>{!function(){if(!window.confirm("データを取得しますか。"))return;var e=location.href.match(/\/(\d+)\//)[1];B("https://www.pixiv.net/ajax/user/"+e+"/illusts/bookmarks?tag=&offset=0&limit=1&rest=show").then(t=>new Promise(i=>{var n=JSON.parse(t),a=n.body.total,o={myId:e,total:a};i(o)})).then(z).then(e=>{(function(e){return new Promise(function(t,i){var n={bookmark:[],user:{}};e.forEach(e=>{var t={};t.id=+e.id,t.title=e.title,t.userId=+e.userId,t.count=+e.pageCount,t.img=e.url.match(/\d{4}\/\d{2}\/\d{2}\/\d{2}\/\d{2}\/\d{2}/)[0],t.ugoku=(()=>2==e.illustType?1:0)(),t.tags=e.tags,n.bookmark.push(t),n.user[e.userId]={name:e.userName,icon:e.profileImageUrl}}),t(n)})})(e).then(e=>{window.confirm("データを上書きしますか。")?(p=(()=>e.bookmark?e.bookmark:[])(),g=(()=>e.user?e.user:{})()):window.confirm("データを更新しますか。")&&(e.bookmark.forEach(e=>{try{var t=p.find(t=>t.id==e.id);t.id=+e.id,t.title=e.title,t.userId=+e.userId,t.count=+e.count,t.img=e.img,t.ugoku=e.ugoku,t.tags=e.tags}catch(e){}}),g=(()=>e.user?e.user:{})());try{document.getElementById("radioNormal").click()}catch(e){}alert("完了")})})}()},!1)}}function I(){return new Promise(function(e,t){dbStorage.get("pbv",t=>{var i=JSON.parse(t);(function(e){return e instanceof Object&&!(e instanceof Array)})(i)||(i={}),p=(()=>i.bookmark?i.bookmark:[])(),g=(()=>i.user?i.user:{})(),e()})})}function E(e){return new Promise(function(t){if(e)dbStorage.add("pbv",e,t);else{var i={bookmark:p,user:g};dbStorage.add("pbv",JSON.stringify(i),t)}})}function B(e){return new Promise(function(t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&(200==n.status?t(n.responseText):i(Error(n.statusText)))},n.onerror=function(){i(Error("Network Error"))},n.open("GET",e),n.send(null)})}function S(){try{for(var e=0;e<b;e++){var t=e+x*b;T((()=>"normal"==f?p[t]:"random"==f?v[t]:m[t])())}}catch(e){console.error(e)}}function T(e){if(null!=e){var t=(()=>"1"==e.count?"display: none;":"")(),i=e.tags.some(e=>"R-18"==e||"R-18G"==e)?"":"display: none;",a=""!=i?"":e.tags.some(e=>"R-18"==e)?"R-18":"R-18G",o=(()=>e.ugoku?"":"display: none;")(),r=(()=>e.ugoku?"":"_p0")(),d=document.getElementById("itemList"),l=(()=>n?document.createElement("li"):document.createElement("div"))();l.classList.add("item"),l.innerHTML=(()=>n?'<div>  <div>    <div>      <a href="https://www.pixiv.net/member_illust.php?mode=medium&illust_id='+e.id+'" target="_blank">        <div>          <div style="'+i+'">            <div>              <div>'+a+'</div>            </div>          </div>          <div style="'+t+'">            <svg>              <path d="M8,3 C8.55228475,3 9,3.44771525 9,4 L9,9 C9,9.55228475 8.55228475,10 8,10 L3,10 C2.44771525,10 2,9.55228475 2,9 L6,9 C7.1045695,9 8,8.1045695 8,7 L8,3 Z M1,1 L6,1 C6.55228475,1 7,1.44771525 7,2 L7,7 C7,7.55228475 6.55228475,8 6,8 L1,8 C0.44771525,8 0,7.55228475 0,7 L0,2 C0,1.44771525 0.44771525,1 1,1 Z"></path>            </svg>            <span>'+e.count+'</span>          </div>        </div>        <div data-tags="'+e.tags.join(" ")+'" style="background-image: url(https://i.pximg.net/c/250x250_80_a2/img-master/img/'+e.img+"/"+e.id+r+'_square1200.jpg);">          <svg viewBox="0 0 24 24" style="'+o+'">            <circle cx="12" cy="12" r="10"></circle>            <path d="M9,8.74841664 L9,15.2515834 C9,15.8038681 9.44771525,16.2515834 10,16.2515834 C10.1782928,16.2515834 10.3533435,16.2039156 10.5070201,16.1135176 L16.0347118,12.8619342 C16.510745,12.5819147 16.6696454,11.969013 16.3896259,11.4929799 C16.3034179,11.3464262 16.1812655,11.2242738 16.0347118,11.1380658 L10.5070201,7.88648243 C10.030987,7.60646294 9.41808527,7.76536339 9.13806578,8.24139652 C9.04766776,8.39507316 9,8.57012386 9,8.74841664 Z"></path>          </svg>        </div>      </a>    </div>  </div>  <a href="https://www.pixiv.net/member_illust.php?mode=medium&illust_id='+e.id+'" target="_blank">'+e.title+'</a>  <div>    <div>      <a href="https://www.pixiv.net/member.php?id='+e.userId+'" target="_blank" style="background-image: url('+g[e.userId].icon+');"></a>    </div>    <a href="https://www.pixiv.net/member.php?id='+e.userId+'" target="_blank">'+g[e.userId].name+"</a>  </div></div>":'<div>  <a href="https://www.pixiv.net/member_illust.php?mode=medium&illust_id='+e.id+'" target="_blank">    <div>      <div class="square"></div>      <div class="image" data-tags="'+e.tags.join(" ")+'" style="background-image: url(https://i.pximg.net/c/540x540_70/img-master/img/'+e.img+"/"+e.id+r+'_square1200.jpg);">        <div class="r18" style="'+i+'">          <span>R-18</span>        </div>        <div class="count" style="'+t+'">          <svg xmlns="http://www.w3.org/2000/svg" width="9" height="9" viewBox="0 0 9 9">            <path fill="#fff" d="M8 2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1h4a2 2 0 002-2V2zM1 0h5a1 1 0 011 1v5a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1z" fill-rule="evenodd"/>          </svg>          <span>'+e.count+'</span>        </div>        <div class="ugoku" style="'+o+'">          <svg width="48" height="48" viewBox="0 0 24 24" fill="none">            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="rgba(0, 0, 0, 0.32)"></path>            <path fill-rule="evenodd" clip-rule="evenodd" d="M10.507 7.88647C9.84039 7.49433 9 7.97499 9 8.7484L9 15.2516C9 16.025 9.84039 16.5056 10.507 16.1135L16.0347 12.8619C16.692 12.4753 16.692 11.5247 16.0347 11.1381L10.507 7.88647Z" fill="#fff"></path>          </svg>        </div>      </div>    </div>  </a></div>')(),d.appendChild(l)}}function j(){return new Promise(function(e,t){for(var i=(v=JSON.parse(JSON.stringify(p))).length-1;i>0;i--){var n=Math.floor(Math.random()*(i+1)),a=v[i];v[i]=v[n],v[n]=a}e()})}function M(){return new Promise(function(e,t){m=[];var i=document.getElementById("inputSearch").value;if(""==i)return f=(()=>document.getElementById("radioRandom").checked?"random":"normal")(),void e();var n=[];n=document.getElementById("radioRandom").checked?v:p;var a,o,r,d=i.replace(/\s/g," ").split(" ");if(/^\/.*\/$/.test(i))a=new RegExp(i.slice(1,-1));else{for(var l=[[]],s=0;s<d.length;s++)"AND"!=d[s]&&"OR"!=d[s]&&"NOT"!=d[s]&&("OR"==d[s-1]?l.push([d[s]]):"NOT"==d[s-1]?l[l.length-1].push("-"+d[s]):l[l.length-1].push(d[s]));o=function(e){return e.replace(/(?=[(){}\[\].*\\^$?])/,"\\")},r=(r="(?:"+l.map(function(e){return"^(?=[\\s\\S]*"+e.map(o).join(")(?=[\\s\\S]*")+")"}).join("|")+")").replace(/=\[\\s\\S\]\*-/g,"![\\s\\S]*"),a=new RegExp(r)}for(s=0;s<n.length;s++){var c=n[s].title+" "+n[s].user+" "+n[s].tags.join(" ");a.test(c)&&m.push(n[s])}f="search",e()})}function N(e,t){var i=document.querySelector("#setInfo .imageContainer .mainImage img"),n="https://i.pximg.net/img-master/img/"+t.image+"/"+t.id+"_p"+e+"_master1200.jpg";i.src=n,function(e){var t=document.querySelector("#setInfo .imageList"),i=document.querySelector("#setInfo .imageList .container"),n=t.getBoundingClientRect(),a=(i.getBoundingClientRect(),152*e+80-n.width/2+76);try{t.scrollTo({left:a,behavior:"smooth"})}catch(e){t.scrollTo(a,0)}}(e),function(e){var t=document.querySelectorAll("#setInfo .imageList .container div");(t=Array.from(t)).forEach(e=>{e.classList.remove("selected")}),t[e].classList.add("selected")}(e)}function R(e,t){return e==t?"selected":""}function q(e,t){e.querySelector("select").addEventListener("change",()=>{var e=document.getElementsByClassName("selemct_tagType")[t].options.selectedIndex;_(t,e)},!1)}function D(e,t){var i=document.getElementsByClassName("selemct_tagType")[e],n=i.options.selectedIndex,a=i.options.length;t<0?++n>=a&&n--:t>0&&--n<0&&(n=0),i.options.selectedIndex=n,_(e,n)}function _(e,t){document.querySelectorAll(".tagConatiner span")[e].className=A(t)}function A(e){return 0==e?"typeTitle":1==e?"typeCharacter":3==e?"typeUsers":""}function O(){k=document.getElementById("inputPageCount").value;var e=(()=>"old"==y?"https://www.pixiv.net/bookmark.php?rest=show&p="+k:"new"==y?"https://www.pixiv.net/bookmark.php?id=9791957&rest=show&p="+k:"")();if(""!=e){var t=document.getElementById("iframeBookmark");n?t.src=e:(t.src="https://www.pixiv.net/redirect_pc.php",setTimeout(function(){t.src=e},1e3))}}function P(){var e,t=document.getElementById("iframeBookmark");try{e=t.contentWindow.location.href}catch(e){return clearInterval(i),!1}if("about:blank"==e)return!1;var n=function(e){for(var t={},i=e.split("?")[1].split("&"),n=0;i[n];n++){var a=i[n].split("=");t[a[0]]=a[1]}return t}(e),a=(()=>n.p?+n.p:1)();return a!=k&&(k=a,document.getElementById("inputPageCount").value=a,a)}function z(e){return new Promise(function(t,i){var n=document.getElementById("optionTextarea");n.value="ループ開始";var a=0,o=Math.ceil(e.total/100),r=[],d=()=>new Promise(function(t,i){n.value=a+1+"/"+o;var r=100*a;t("https://www.pixiv.net/ajax/user/"+e.myId+"/illusts/bookmarks?tag=&offset="+r+"&limit=100&rest=show")}).then(B).then(e=>{var i=JSON.parse(e).body.works;r=r.concat(i),++a<o?d():(n.value="",t(r))});d()})}window.onscroll=(()=>{c==u[0]&&function(){if(n){var e=document.querySelector("#itemList .item:last-child");if(!e)return;var t=a.scrollTop+a.clientHeight,i=e.offsetTop-a.offsetTop;i<t+w&&(x++,S())}else{var o=document.body.scrollTop||document.documentElement.scrollTop,r=document.body.clientHeight,d=document.body.scrollHeight||document.docomentElement.scrollHeight;d===r&&(r=window.innerHeight);var l=d-r-o;l<=200&&(x++,S())}}()}),function(){if(n){for(var e=document.querySelectorAll("#root>div:nth-child(3)>div>div:nth-child(2)>div"),i=1;i<e.length;i++)e[i].parentNode.removeChild(e[i]);var a=document.createElement("style"),v=document.createTextNode(o);a.media="screen",a.type="text/css",a.appendChild(v),document.head.appendChild(a),(t=document.createElement("div")).id="pbvContainer",t.style.margin="0 auto 96px",t.style.maxWidth="1224px",t.innerHTML=l,document.querySelector("#root>div:nth-child(3)>div>div:nth-child(2)").appendChild(t)}else a=document.createElement("style"),v=document.createTextNode(o),a.media="screen",a.type="text/css",a.appendChild(v),document.head.appendChild(a),(t=document.querySelector("#spa-contents>div:nth-child(4)>div:nth-child(5)")).id="pbvContainer",t.innerHTML=l;var m=t.previousElementSibling;m.id="pbvNav",m.innerHTML=r;var h=document.querySelectorAll("#pbvNav a");(h=Array.from(h)).forEach((e,i)=>{e.addEventListener("click",()=>{c!=u[i]&&(e.classList.add("active"),h.forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),c=u[i],function(){var e;c==u[0]?(t.innerHTML=l,f="normal",x=0,S()):c==u[1]?t.innerHTML=null:c==u[2]?(t.innerHTML=d,function(e){var t=p.find(t=>t.id==e),i={id:e,title:t.title,user:g[t.userId].name,image:t.img,count:t.count},a=document.querySelector("#setInfo .title h1 a");a.textContent=i.title,a.href="https://www.pixiv.net/artworks/"+t.id,(a=document.querySelector("#setInfo .title h2 a")).textContent=i.user,a.href="https://www.pixiv.net/member.php?id="+t.userId;var o=document.querySelector("#setInfo .imageContainer .mainImage");o.innerHTML=null;var r=document.createElement("img");r.src="https://i.pximg.net/img-master/img/"+i.image+"/"+i.id+"_p0_master1200.jpg",o.appendChild(r);var d=document.querySelector("#setInfo .imageContainer .imageList");if(i.count>1){d.style.display=null;var l=document.querySelector("#setInfo .imageContainer .imageList .container");l.innerHTML=null;for(var s=0;s<i.count;s++){var c=document.createElement("div");c.style.backgroundImage="url(https://i.pximg.net/c/250x250_80_a2/img-master/img/"+i.image+"/"+i.id+"_p"+s+"_master1200.jpg)",(e=>{c.addEventListener("click",()=>{N(e,i)},!1)})(s),0==s&&c.classList.add("selected"),l.appendChild(c)}l.style.width="calc(152px * "+i.count+")"}else d.style.display="none";!function(e){var t=document.querySelector("#setInfo .tag .tagConatiner");t.innerHTML=null;for(var i=document.createDocumentFragment(),a=0;a<e.tags.length;a++){var o=document.createElement("dl");o.innerHTML=(()=>'<dt><span class="'+A(2)+'">'+e.tags[a]+'</span></dt><dd><select class="selemct_tagType"><option '+R(0,2)+">作品名</option><option "+R(1,2)+">キャラクター名</option><option "+R(2,2)+" selected>その他</option><option "+R(3,2)+">users入り</option></select></dd>")(),q(o,a),(e=>{if(n){var t=o.querySelector("select");window.addEventListener&&t.addEventListener("DOMMouseScroll",function(t){t.preventDefault(),D(e,t.detail)},!1),document.attachEvent&&t.attachEvent("onmousewheel",function(t){t.preventDefault(),D(e,t.wheelDelta)}),t.onmousewheel=function(t){t.preventDefault(),D(e,t.wheelDelta)}}})(a),i.appendChild(o)}t.appendChild(i)}(t)}((e=p,e[Math.floor(Math.random()*e.length)]).id)):c==u[3]?(t.innerHTML=s,bookmarkPage="",y="",k=1,C=!1,document.getElementById("optionTextarea").placeholder="「データの表示」　ここに現在のデータを表示します。\r\n\r\n「データの保存」　データをストレージに保存します。また、ここに書かれたデータを現在のデータに上書き保存します。\r\n\r\n「データの読み込み」　ここに書かれたURLのファイル内容を上書き保存します。（dropboxの共有URLでも可）\r\n\r\n「データの取得」　APIを用いてデータを取得します。取得後、上書き または 情報の更新ができます。 ※ストレージに保存はしません。\r\n\r\n"):t.innerHTML=null}(),L())},!1)})}(),L(),I().then(()=>{try{document.getElementById("radioNormal").click()}catch(e){}}),S(),j()})();
